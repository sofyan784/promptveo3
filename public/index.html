<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROMPT GENERATOR BY FYN (dengan Terjemahan Otomatis & Gemini AI)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700;800&display=swap" rel="stylesheet"> 
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f8fc;
        }
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        @media (min-width: 768px) {
            .app-container {
                padding: 2rem;
            }
        }
        .main-card {
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px -15px rgba(0, 0, 0, 0.08);
            padding: 2rem;
        }
        .app-title {
            font-family: 'Poppins', sans-serif;
            font-size: 2.25rem;
            font-weight: 800;
            line-height: 1.2;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #4b5563;
        }
        input[type="text"],
        input[type="password"],
        textarea,
        select {
            width: 100%;
            padding: 0.85rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 10px;
            margin-bottom: 1rem;
            box-sizing: border-box;
            background-color: #f9fafb;
            color: #374151;
            transition: all 0.2s ease-in-out;
        }
        input[type="text"]:focus,
        input[type="password"]:focus,
        textarea:focus,
        select:focus {
            border-color: #3b82f6;
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
            background-color: white;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        .btn {
            padding: 0.85rem 1.5rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s ease-in-out;
        }
        .btn:active {
            transform: translateY(1px) scale(0.98);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .btn-primary {
            background: linear-gradient(90deg, #3b82f6, #6366f1);
            color: white;
            box-shadow: 0 4px 15px -5px rgba(59, 130, 246, 0.4);
        }
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px -8px rgba(59, 130, 246, 0.6);
        }
        .btn-gemini {
            background: linear-gradient(90deg, #8b5cf6, #a855f7);
            color: white;
            box-shadow: 0 4px 15px -5px rgba(139, 92, 246, 0.4);
        }
        .btn-gemini:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px -8px rgba(139, 92, 246, 0.6);
        }
        .btn-secondary {
            background-color: #e5e7eb;
            color: #4b5563;
        }
        .btn-secondary:hover:not(:disabled) {
            background-color: #d1d5db;
        }
        .prompt-output-card {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 16px;
            padding: 1.5rem;
            position: relative;
        }
        .prompt-output-card h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 1rem;
        }
        #promptOutputIdEditable, #promptOutputEnFinal {
            background-color: white;
            border: 1px solid #d1d5db;
            border-radius: 10px;
            min-height: 180px;
        }
        #promptOutputEnFinal {
            background-color: #f0f9ff;
            border-color: #bae6fd;
            color: #0c4a6e;
            padding: 1rem;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #1f2937;
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s, transform 0.5s;
        }
        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        .loader {
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="text-center mb-8">
            <h1 class="app-title">Prompt Generator</h1>
            <p class="text-gray-500 mt-2">Dibuat dengan âœ¨ oleh FYN AI</p>
        </div>
        
        <div class="main-card">
            <!-- API Key Input Section -->
            <div class="mb-8 bg-blue-50 border border-blue-200 p-5 rounded-xl">
                <label for="apiKeyInput" class="font-semibold text-blue-800">Kunci API Gemini Anda</label>
                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mt-2">
                    <input type="password" id="apiKeyInput" class="flex-grow !m-0" placeholder="Masukkan Kunci API Gemini Anda di sini...">
                    <button id="saveApiBtn" class="btn btn-primary flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                        <span>Simpan</span>
                    </button>
                </div>
                 <p class="text-xs text-blue-600 mt-2">Kunci API diperlukan untuk fitur "Buat Ide Acak" dan "Kembangkan Prompt".</p>
                 <p class="text-xs text-blue-600 mt-1">Dapatkan Kunci API Anda di <a href="https://aistudio.google.com/" target="_blank" rel="noopener noreferrer" class="font-semibold underline hover:text-blue-700">Google AI Studio</a>.</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-x-8">
                <!-- Left Column -->
                <div>
                    <label for="subject">1. Subjek Utama</label>
                    <input type="text" id="subject" placeholder="Contoh: astronot pemberani, naga merah raksasa">

                    <label for="subjectClothing">2. Pakaian Subjek</label> 
                    <input type="text" id="subjectClothing" placeholder="Contoh: baju zirah perak, gaun malam elegan"> 
                    
                    <label for="nationality">3. Kebangsaan Subjek</label>
                    <select id="nationality">
                        <option value="Tidak Spesifik" data-en="Not Specified">Tidak Spesifik</option>
                        <option value="Indonesia" data-en="Indonesian">Indonesia</option>
                        <option value="Amerika Serikat" data-en="American">Amerika Serikat</option>
                        <option value="Inggris" data-en="British">Inggris</option>
                        <option value="Jepang" data-en="Japanese">Jepang</option>
                        <option value="Korea Selatan" data-en="South Korean">Korea Selatan</option>
                        <option value="Tiongkok" data-en="Chinese">Tiongkok</option>
                        <option value="India" data-en="Indian">India</option>
                        <option value="Prancis" data-en="French">Prancis</option>
                        <option value="Jerman" data-en="German">Jerman</option>
                        <option value="Spanyol" data-en="Spanish">Spanyol</option>
                        <option value="Rusia" data-en="Russian">Rusia</option>
                        <option value="Brasil" data-en="Brazilian">Brasil</option>
                        <option value="Lainnya" data-en="Other">Lainnya</option>
                    </select>

                    <label for="action">4. Aksi Utama</label>
                    <input type="text" id="action" placeholder="Contoh: menjelajahi planet asing, terbang di atas pegunungan">

                    <label for="expression">5. Ekspresi Subjek</label>
                    <input type="text" id="expression" placeholder="Contoh: tersenyum bahagia, terlihat penasaran, marah">
                    
                    <label for="place">6. Tempat/Setting</label>
                    <input type="text" id="place" placeholder="Contoh: hutan berkabut, kota metropolitan futuristik">

                    <label for="time">7. Waktu</label>
                    <select id="time">
                        <option value="Pagi Hari" data-en="Morning">Pagi Hari (Sunrise/Morning)</option>
                        <option value="Siang Hari" data-en="Daytime">Siang Hari (Daytime/Noon)</option>
                        <option value="Sore Hari (Golden Hour)" data-en="Afternoon (Golden Hour)">Sore Hari (Golden Hour)</option>
                        <option value="Senja" data-en="Dusk">Senja (Dusk/Twilight)</option>
                        <option value="Malam Hari" data-en="Night">Malam Hari (Night)</option>
                    </select>
                </div>
                <!-- Right Column -->
                <div>
                    <label for="cameraMovement">8. Gerakan Kamera</label>
                    <select id="cameraMovement">
                        <option value="Static Shot" data-en="Static Shot">Static Shot (Statis)</option>
                        <option value="Zoom In" data-en="Zoom In">Zoom In (Perbesar)</option>
                        <option value="Zoom Out" data-en="Zoom Out">Zoom Out (Perkecil)</option>
                        <option value="Pan Left" data-en="Pan Left">Pan Left (Geser Kiri)</option>
                        <option value="Pan Right" data-en="Pan Right">Pan Right (Geser Kanan)</option>
                        <option value="Pan Up" data-en="Pan Up">Pan Up (Geser Atas)</option>
                        <option value="Pan Down" data-en="Pan Down">Pan Down (Geser Bawah)</option>
                        <option value="Tilt Up" data-en="Tilt Up">Tilt Up (Dongak ke Atas)</option>
                        <option value="Tilt Down" data-en="Tilt Down">Tunduk ke Bawah)</option>
                        <option value="Rotate Clockwise" data-en="Rotate Clockwise">Rotate Clockwise (Putar Searah Jarum Jam)</option>
                        <option value="Rotate Counter-Clockwise" data-en="Rotate Counter-Clockwise">Rotate Counter-Clockwise (Putar Berlawanan Arah Jarum Jam)</option>
                        <option value="Dolly In" data-en="Dolly In">Dolly In (Maju Mendekat)</option>
                        <option value="Dolly Out" data-en="Dolly Out">Dolly Out (Mundur Menjauh)</option>
                        <option value="Tracking Shot" data-en="Tracking Shot">Tracking Shot (Mengikuti Objek)</option>
                        <option value="Crane Shot Up" data-en="Crane Shot Up">Crane Shot Up (Tangkapan Derek ke Atas)</option>
                        <option value="Crane Shot Down" data-en="Crane Shot Down">Crane Shot Down (Tangkapan Derek ke Bawah)</option>
                        <option value="Aerial View / Drone Shot" data-en="Aerial View / Drone Shot">Aerial View / Drone Shot (Tampilan Udara)</option>
                        <option value="First-Person View (FPV)" data-en="First-Person View (FPV)">First-Person View (FPV)</option>
                        <option value="Third-Person View (TPV)" data-en="Third-Person View (TPV)">Third-Person View (TPV)</option>
                        <option value="Orbit" data-en="Orbit">Orbit (Mengorbit)</option>
                        <option value="Boom Up" data-en="Boom Up">Boom Up (Gerakan Boom Naik)</option>
                        <option value="Boom Down" data-en="Boom Down">Boom Down (Gerakan Boom Turun)</option>
                        <option value="Truck Left" data-en="Truck Left">Truck Left (Gerakan Truk Kiri)</option>
                        <option value="Truck Right" data-en="Truck Right">Truck Right (Gerakan Truk Kanan)</option>
                        <option value="Arc Shot" data-en="Arc Shot">Arc Shot (Tangkapan Melengkung)</option>
                        <option value="Handheld Shot" data-en="Handheld Shot">Handheld Shot (Gaya Genggam)</option>
                        <option value="Whip Pan" data-en="Whip Pan">Whip Pan (Geseran Cepat)</option>
                    </select>

                    <label for="lighting">9. Pencahayaan</label>
                    <select id="lighting">
                        <option value="Cahaya Alami Terang" data-en="Bright Natural Light">Cahaya Alami Terang</option>
                        <option value="Cahaya Alami Redup" data-en="Dim Natural Light">Cahaya Alami Redup</option>
                        <option value="Pencahayaan Studio Profesional" data-en="Professional Studio Lighting">Pencahayaan Studio Profesional</option>
                        <option value="Lampu Neon Berwarna-warni" data-en="Colorful Neon Lights">Lampu Neon Berwarna-warni</option>
                        <option value="Cahaya Lilin Hangat" data-en="Warm Candlelight">Cahaya Lilin Hangat</option>
                        <option value="Siluet Tajam" data-en="Sharp Silhouette">Siluet Tajam</option>
                        <option value="Pencahayaan Dramatis dengan Bayangan Kuat" data-en="Dramatic Lighting with Strong Shadows">Pencahayaan Dramatis</option>
                        <option value="Golden Hour Lembut" data-en="Soft Golden Hour">Golden Hour Lembut</option>
                        <option value="Blue Hour Misterius" data-en="Mysterious Blue Hour">Blue Hour Misterius</option>
                        <option value="Backlight yang Menciptakan Halo Effect" data-en="Backlight creating Halo Effect">Backlight (Efek Halo)</option>
                        <option value="Rim Light yang Menegaskan Kontur" data-en="Rim Light emphasizing Contours">Rim Light (Menegaskan Kontur)</option>
                    </select>

                    <label for="videoStyle">10. Gaya Video</label>
                    <select id="videoStyle">
                        <option value="Sangat Fotorealistik" data-en="Hyperrealistic">Sangat Fotorealistik (Hyperrealistic)</option>
                        <option value="Sinematik dengan Depth of Field" data-en="Cinematic with Depth of Field">Sinematik (Depth of Field)</option>
                        <option value="Gaya Anime Klasik" data-en="Classic Anime Style">Gaya Anime Klasik</option>
                        <option value="Gaya Anime Modern Detail" data-en="Modern Detailed Anime Style">Gaya Anime Modern Detail</option>
                        <option value="Lukisan Digital Artistik" data-en="Artistic Digital Painting">Lukisan Digital Artistik</option>
                        <option value="Fantasi Epik Detail Tinggi" data-en="High Detail Epic Fantasy">Fantasi Epik Detail Tinggi</option>
                        <option value="Cyberpunk Neon Gelap" data-en="Dark Neon Cyberpunk">Cyberpunk Neon Gelap</option>
                        <option value="Steampunk Mekanikal" data-en="Mechanical Steampunk">Steampunk Mekanikal</option>
                        <option value="Kartun 3D Halus" data-en="Smooth 3D Cartoon">Kartun 3D Halus</option>
                        <option value="Film Hitam Putih Noir Klasik" data-en="Classic Black & White Noir Film">Film Hitam Putih Noir Klasik</option>
                        <option value="Estetika Vaporwave" data-en="Vaporwave Aesthetics">Estetika Vaporwave</option>
                        <option value="Gaya Dokumenter Realistis" data-en="Realistic Documentary Style">Gaya Dokumenter Realistis</option>
                        <option value="Film Vintage dengan Grain" data-en="Vintage Film with Grain">Film Vintage (Grain)</option>
                        <option value="Animasi Stop Motion Unik" data-en="Unique Stop Motion Animation">Animasi Stop Motion Unik</option>
                        <option value="Time-lapse Pemandangan" data-en="Scenic Time-lapse">Time-lapse Pemandangan</option>
                        <option value="Slow Motion Dramatis" data-en="Dramatic Slow Motion">Slow Motion Dramatis</option>
                    </select>

                    <label for="videoMood">11. Suasana Video</label>
                    <select id="videoMood">
                        <option value="Ceria dan Optimistis" data-en="Cheerful and Optimistic">Ceria dan Optimistis</option>
                        <option value="Sedih dan Melankolis" data-en="Sad and Melancholic">Sedih dan Melankolis</option>
                        <option value="Misterius dan Penuh Teka-teki" data-en="Mysterious and Puzzling">Misterius dan Penuh Teka-teki</option>
                        <option value="Tegang dan Mencekam" data-en="Tense and Suspenseful">Tegang dan Mencekam</option>
                        <option value="Romantis dan Hangat" data-en="Romantic and Warm">Romantis dan Hangat</option>
                        <option value="Menakutkan dan Mengerikan" data-en="Scary and Horrifying">Menakutkan dan Mengerikan</option>
                        <option value="Damai dan Menenangkan" data-en="Peaceful and Calming">Damai dan Menenangkan</option>
                        <option value="Energik dan Bersemangat" data-en="Energetic and Vibrant">Energik dan Bersemangat</option>
                        <option value="Nostalgia dan Penuh Kenangan" data-en="Nostalgic and Memorable">Nostalgia dan Penuh Kenangan</option>
                        <option value="Ajaib dan Mempesona" data-en="Magical and Enchanting">Ajaib dan Mempesona</option>
                        <option value="Futuristik dan Canggih" data-en="Futuristic and Advanced">Futuristik dan Canggih</option>
                        <option value="Komedik dan Lucu" data-en="Comedic and Funny">Komedik dan Lucu</option>
                        <option value="Epik dan Megah" data-en="Epic and Grandiose">Epik dan Megah</option>
                    </select>
                </div>
            </div>

            <!-- Bottom Section -->
            <div class="mt-4 border-t pt-8">
                <label for="genreFilm">12. Genre Film</label>
                <select id="genreFilm">
                    <option value="Tidak Spesifik">Tidak Spesifik</option>
                    <option value="Drama Perang">Drama Perang</option>
                    <option value="Romansa">Romansa</option>
                    <option value="Film Bencana">Film Bencana</option>
                    <option value="Fiksi Ilmiah">Fiksi Ilmiah</option>
                    <option value="Fiksi Ilmiah Kontemporer">Fiksi Ilmiah Kontemporer</option>
                    <option value="Horor">Horor</option>
                    <option value="Komedi">Komedi</option>
                    <option value="Laga">Laga</option>
                </select>
                
                 <label for="soundMusic">13. Suara atau Musik</label>
                <input type="text" id="soundMusic" placeholder="Contoh: musik orkestra epik, suara alam yang tenang, tanpa suara">

                <label for="language">14. Bahasa (untuk Suara/Kalimat)</label>
                <select id="language">
                    <option value="Tidak Spesifik" data-en="Not Specified">Tidak Spesifik</option>
                    <optgroup label="Bahasa Daerah Indonesia">
                        <option value="Jawa" data-en="Javanese">Bahasa Jawa</option>
                        <option value="Sunda" data-en="Sundanese">Bahasa Sunda</option>
                        <option value="Madura" data-en="Madurese">Bahasa Madura</option>
                        <option value="Minangkabau" data-en="Minangkabau">Bahasa Minangkabau</option>
                        <option value="Betawi" data-en="Betawi">Bahasa Betawi</option>
                        <option value="Bali" data-en="Balinese">Bahasa Bali</option>
                        <option value="Batak" data-en="Batak">Bahasa Batak</option>
                    </optgroup>
                    <optgroup label="Bahasa Internasional">
                        <option value="Indonesia" data-en="Indonesian">Indonesia</option>
                        <option value="Inggris" data-en="English">Inggris</option>
                        <option value="Jepang" data-en="Japanese">Jepang</option>
                        <option value="Korea" data-en="Korean">Korea</option>
                        <option value="Mandarin" data-en="Mandarin">Mandarin</option>
                        <option value="Spanyol" data-en="Spanish">Spanyol</option>
                        <option value="Prancis" data-en="French">Prancis</option>
                        <option value="Jerman" data-en="German">Jerman</option>
                        <option value="Rusia" data-en="Russian">Rusia</option>
                        <option value="Arab" data-en="Arabic">Arab</option>
                        <option value="Hindi" data-en="Hindi">Hindi</option>
                        <option value="Portugis" data-en="Portuguese">Portugis</option>
                        <option value="Belanda" data-en="Dutch">Belanda</option>
                    </optgroup>
                    <option value="Lainnya" data-en="Other">Lainnya</option>
                </select>

                <label for="spokenLines">15. Kalimat yang Diucapkan (jika ada)</label>
                <input type="text" id="spokenLines" placeholder="Contoh: 'Kita berhasil!', 'Di mana aku?'">

                <label for="additionalDetails">16. Detail Tambahan (opsional)</label>
                <textarea id="additionalDetails" placeholder="Contoh: efek partikel debu, lensa flare, kualitas 8K, rasio aspek 16:9"></textarea>
            </div>
            
            <div class="flex flex-col md:flex-row gap-3 mt-6">
                <button id="geminiIdeaBtn" class="btn btn-gemini w-full md:w-auto" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg>
                    <span>Buat Ide Acak</span>
                </button>
                <button id="generateBtn" class="btn btn-primary flex-grow">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                    <span>Hasilkan Prompt</span>
                </button>
            </div>
             
            <div id="generatedPromptOutputsContainer" class="mt-10 space-y-6" style="display: none;">
                <div class="prompt-output-card">
                    <div class="flex justify-between items-center mb-4">
                        <h3>ðŸ‡®ðŸ‡© Prompt Bahasa Indonesia</h3>
                        <button id="copyIdBtn" class="btn btn-secondary">
                             <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                             <span>Salin</span>
                        </button>
                    </div>
                    <textarea id="promptOutputIdEditable"></textarea>
                </div>

                <div class="prompt-output-card">
                     <div class="flex justify-between items-start mb-4 gap-4">
                        <h3>ðŸ‡¬ðŸ‡§ Prompt Bahasa Inggris</h3>
                        <div class="flex gap-2">
                             <button id="copyEnBtn" class="btn btn-secondary">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                                 <span>Salin</span>
                            </button>
                            <button id="geminiImproveBtn" class="btn btn-gemini" disabled>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg>
                                <span>Kembangkan</span>
                            </button>
                        </div>
                    </div>
                    <p id="promptOutputEnFinal"></p>
                </div>
            </div>
        </div>
    </div>

    <div id="toastNotification" class="toast"></div>

    <script>
        // Global variable for API Key
        let userApiKey = '';

        // Get DOM elements
        const apiKeyInput = document.getElementById('apiKeyInput');
        const saveApiBtn = document.getElementById('saveApiBtn');

        const subjectInput = document.getElementById('subject');
        const subjectClothingInput = document.getElementById('subjectClothing');
        const nationalitySelect = document.getElementById('nationality');
        const actionInput = document.getElementById('action');
        const expressionInput = document.getElementById('expression');
        const placeInput = document.getElementById('place');
        const timeSelect = document.getElementById('time');
        const cameraMovementSelect = document.getElementById('cameraMovement');
        const lightingSelect = document.getElementById('lighting');
        const videoStyleSelect = document.getElementById('videoStyle');
        const videoMoodSelect = document.getElementById('videoMood');
        const genreFilmSelect = document.getElementById('genreFilm');
        const soundMusicInput = document.getElementById('soundMusic');
        const languageSelect = document.getElementById('language');
        const spokenLinesInput = document.getElementById('spokenLines');
        const additionalDetailsTextarea = document.getElementById('additionalDetails');

        const generateBtn = document.getElementById('generateBtn');
        const geminiIdeaBtn = document.getElementById('geminiIdeaBtn');
        const geminiImproveBtn = document.getElementById('geminiImproveBtn');
        const copyIdBtn = document.getElementById('copyIdBtn');
        const copyEnBtn = document.getElementById('copyEnBtn');
        
        const promptOutputIdEditable = document.getElementById('promptOutputIdEditable');
        const promptOutputEnFinal = document.getElementById('promptOutputEnFinal');
        const generatedPromptOutputsContainer = document.getElementById('generatedPromptOutputsContainer');
        const toastNotification = document.getElementById('toastNotification');

        // Save API Key
        saveApiBtn.addEventListener('click', () => {
            const key = apiKeyInput.value.trim();
            if (key) {
                userApiKey = key;
                geminiIdeaBtn.disabled = false;
                geminiImproveBtn.disabled = false;
                showToast("Kunci API berhasil disimpan!");
                apiKeyInput.style.borderColor = '#10b981';
            } else {
                showToast("Mohon masukkan Kunci API yang valid.", true);
                apiKeyInput.style.borderColor = '#ef4444';
            }
        });

        function getSelectedEnText(selectElement) {
            return selectElement.options[selectElement.selectedIndex].dataset.en;
        }
        
        function setSelectValue(selectElement, value, defaultValue) {
            const option = Array.from(selectElement.options).find(opt => opt.value === value);
            if (option) {
                selectElement.value = value;
            } else {
                console.warn(`Nilai "${value}" tidak ditemukan untuk dropdown ${selectElement.id}. Menggunakan nilai default.`);
                selectElement.value = defaultValue;
            }
        }

        async function callGeminiAPI(prompt, schema = null) {
            if (!userApiKey) {
                throw new Error("Kunci API Gemini belum diatur.");
            }
        
            const MAX_RETRIES = 3;
            const INITIAL_RETRY_DELAY = 1000;
            let lastError;
        
            for (let attempt = 1; attempt <= MAX_RETRIES; attempt++) {
                try {
                    const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${userApiKey}`;
                    
                    const payload = {
                        contents: [{ role: "user", parts: [{ text: prompt }] }]
                    };
        
                    if (schema) {
                        payload.generationConfig = {
                            responseMimeType: "application/json",
                            responseSchema: schema
                        };
                    }
        
                    const response = await fetch(GEMINI_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
        
                    if (response.ok) {
                        const result = await response.json();
                        if (result.candidates && result.candidates[0]?.content?.parts?.[0]) {
                            return result.candidates[0].content.parts[0].text;
                        }
                        if (result.promptFeedback?.blockReason) {
                            throw new Error(`Permintaan diblokir: ${result.promptFeedback.blockReason}`);
                        }
                        throw new Error("Respons API tidak valid atau kosong.");
                    }
        
                    if (response.status === 503) {
                        lastError = new Error(`Layanan API tidak tersedia (503).`);
                        if (attempt < MAX_RETRIES) {
                            const delay = INITIAL_RETRY_DELAY * Math.pow(2, attempt - 1);
                            await new Promise(resolve => setTimeout(resolve, delay));
                            continue;
                        }
                    } else if (response.status === 401) {
                        throw new Error(`Otorisasi Gagal (401). Periksa Kunci API Anda.`);
                    } else {
                         const errorBody = await response.text();
                         throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                } catch (error) {
                    lastError = error;
                    if (attempt >= MAX_RETRIES) break;
                    const delay = INITIAL_RETRY_DELAY * Math.pow(2, attempt - 1);
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
            
            throw new Error(`Gagal menghubungi server AI setelah ${MAX_RETRIES} percobaan. (Kesalahan: ${lastError.message})`);
        }

        function setButtonLoading(button, isLoading) {
            const span = button.querySelector('span');
            if (isLoading) {
                button.disabled = true;
                span.style.display = 'none';
                const loader = document.createElement('div');
                loader.className = 'loader';
                button.prepend(loader);
            } else {
                button.disabled = false;
                span.style.display = 'inline';
                const loader = button.querySelector('.loader');
                if (loader) {
                    loader.remove();
                }
            }
        }
        
        geminiIdeaBtn.addEventListener('click', async () => {
            setButtonLoading(geminiIdeaBtn, true);

            try {
                // Helper to get options from a select element
                const getSelectOptions = (elementId) => {
                    const select = document.getElementById(elementId);
                    // Filter out the "Tidak Spesifik" option
                    return Array.from(select.options)
                                .filter(opt => opt.value !== 'Tidak Spesifik')
                                .map(opt => `"${opt.value}"`).join(', ');
                };
                
                // --- NEW WORKFLOW ---
                // 1. Randomly pick a genre first
                const genreOptions = Array.from(genreFilmSelect.options)
                                          .map(opt => opt.value)
                                          .filter(val => val !== 'Tidak Spesifik');
                const randomGenre = genreOptions[Math.floor(Math.random() * genreOptions.length)];
                
                // Update the UI immediately
                genreFilmSelect.value = randomGenre;


                const prompt = `Buatkan ide untuk sebuah adegan film pendek yang sinematik dengan genre "${randomGenre}". Deskripsikan secara visual dan puitis. Hasilnya HARUS objek JSON SAJA, tanpa teks lain.
                Struktur: {"subjek":"...","pakaian":"...","ekspresi":"...","aksi":"...","tempat":"...","suara_musik":"...","kalimat_diucapkan":"...","detail_tambahan":"...","kebangsaan":"...","waktu":"...","gerakan_kamera":"...","pencahayaan":"...","gaya_video":"...","suasana_video":"...","bahasa":"..."}.
                Aturan:
                1. Buat SEMUA elemen agar cocok dengan genre "${randomGenre}" secara kreatif.
                2. Semua nilai dalam Bahasa Indonesia dan deskriptif (3-15 kata). 'kalimat_diucapkan' bisa kosong ("").
                3. Untuk pilihan dropdown, pilih SATU dari daftar yang paling cocok dengan nuansa adegan:
                   - 'kebangsaan': [${getSelectOptions('nationality')}]
                   - 'waktu': [${getSelectOptions('time')}]
                   - 'gerakan_kamera': [${getSelectOptions('cameraMovement')}]
                   - 'pencahayaan': [${getSelectOptions('lighting')}]
                   - 'gaya_video': [${getSelectOptions('videoStyle')}]
                   - 'suasana_video': [${getSelectOptions('videoMood')}]
                   - 'bahasa': [${getSelectOptions('language')}]`;
                
                const ideaSchema = {
                    type: "OBJECT",
                    properties: { "subjek": { "type": "STRING" }, "pakaian": { "type": "STRING" }, "ekspresi": { "type": "STRING" }, "aksi": { "type": "STRING" }, "tempat": { "type": "STRING" }, "suara_musik": { "type": "STRING" }, "kalimat_diucapkan": { "type": "STRING" }, "detail_tambahan": { "type": "STRING" }, "kebangsaan": { "type": "STRING" }, "waktu": { "type": "STRING" }, "gerakan_kamera": { "type": "STRING" }, "pencahayaan": { "type": "STRING" }, "gaya_video": { "type": "STRING" }, "suasana_video": { "type": "STRING" }, "bahasa": { "type": "STRING" } },
                    // The AI no longer needs to return genre_film as we are now providing it.
                    required: ["subjek", "pakaian", "aksi", "ekspresi", "tempat", "suara_musik", "kalimat_diucapkan", "detail_tambahan", "kebangsaan", "waktu", "gerakan_kamera", "pencahayaan", "gaya_video", "suasana_video", "bahasa"]
                };

                const responseText = await callGeminiAPI(prompt, ideaSchema);
                
                let idea;
                try {
                    let jsonString = responseText;
                    const startIndex = jsonString.indexOf('{');
                    const endIndex = jsonString.lastIndexOf('}');
                    if (startIndex === -1 || endIndex === -1) throw new Error("Respons AI tidak mengandung format JSON.");
                    jsonString = jsonString.substring(startIndex, endIndex + 1);
                    idea = JSON.parse(jsonString);
                } catch (parseError) {
                    throw new Error("Gagal memproses respons AI.");
                }

                // Fill all form fields from AI idea
                subjectInput.value = idea.subjek || '';
                subjectClothingInput.value = idea.pakaian || '';
                expressionInput.value = idea.ekspresi || '';
                actionInput.value = idea.aksi || '';
                placeInput.value = idea.tempat || '';
                soundMusicInput.value = idea.suara_musik || '';
                spokenLinesInput.value = idea.kalimat_diucapkan || '';
                additionalDetailsTextarea.value = idea.detail_tambahan || '';
                
                // Set dropdowns with validation
                setSelectValue(nationalitySelect, idea.kebangsaan, 'Tidak Spesifik');
                setSelectValue(timeSelect, idea.waktu, 'Siang Hari');
                setSelectValue(cameraMovementSelect, idea.gerakan_kamera, 'Static Shot');
                setSelectValue(lightingSelect, idea.pencahayaan, 'Cahaya Alami Terang');
                setSelectValue(videoStyleSelect, idea.gaya_video, 'Sangat Fotorealistik');
                setSelectValue(videoMoodSelect, idea.suasana_video, 'Ceria dan Optimistis');
                setSelectValue(languageSelect, idea.bahasa, 'Tidak Spesifik');
                
                showToast(`âœ¨ Ide Acak (${randomGenre}) berhasil dibuat oleh AI!`);
                
            } catch (error) {
                showToast(error.message, true);
            } finally {
                setButtonLoading(geminiIdeaBtn, false);
            }
        });

        geminiImproveBtn.addEventListener('click', async () => {
            const currentPrompt = promptOutputEnFinal.textContent;
            if (!currentPrompt) {
                showToast("Tidak ada prompt untuk dikembangkan.", true);
                return;
            }

            setButtonLoading(geminiImproveBtn, true);

            try {
                 const developPrompt = `Tugas Anda adalah dua bagian:
                1. Ambil prompt video berikut dan kembangkan menjadi deskripsi adegan yang lebih detail, hidup, dan sinematik dalam Bahasa Inggris. Tambahkan detail visual, tekstur, dan perluas suasana hati.
                2. Dari deskripsi baru yang Anda buat, ekstrak komponen-komponen utamanya ke dalam Bahasa Indonesia.
                
                Hasilnya HARUS berupa objek JSON SAJA dengan struktur: {"developed_english_prompt": "...", "subjek": "...", "pakaian": "...", "ekspresi": "...", "aksi": "...", "tempat": "...", "suara_musik": "...", "kalimat_diucapkan": "...", "detail_tambahan": "..."}
                
                Prompt Asli:
                "${currentPrompt}"`;

                const developSchema = {
                    type: "OBJECT",
                    properties: {
                        "developed_english_prompt": { "type": "STRING" },
                        "subjek": { "type": "STRING" },
                        "pakaian": { "type": "STRING" },
                        "ekspresi": { "type": "STRING" },
                        "aksi": { "type": "STRING" },
                        "tempat": { "type": "STRING" },
                        "suara_musik": { "type": "STRING" },
                        "kalimat_diucapkan": { "type": "STRING" },
                        "detail_tambahan": { "type": "STRING" }
                    },
                    required: ["developed_english_prompt", "subjek", "pakaian", "aksi", "ekspresi", "tempat", "suara_musik", "kalimat_diucapkan", "detail_tambahan"]
                };
                
                const responseText = await callGeminiAPI(developPrompt, developSchema);

                let idea;
                try {
                    let jsonString = responseText;
                    const startIndex = jsonString.indexOf('{');
                    const endIndex = jsonString.lastIndexOf('}');
                    if (startIndex === -1 || endIndex === -1) throw new Error("Format JSON tidak valid dari AI.");
                    jsonString = jsonString.substring(startIndex, endIndex + 1);
                    idea = JSON.parse(jsonString);
                } catch (e) {
                    throw new Error("Gagal memproses respons AI yang dikembangkan.");
                }

                // Update UI
                promptOutputEnFinal.textContent = idea.developed_english_prompt;
                subjectInput.value = idea.subjek || '';
                subjectClothingInput.value = idea.pakaian || '';
                expressionInput.value = idea.ekspresi || '';
                actionInput.value = idea.aksi || '';
                placeInput.value = idea.tempat || '';
                soundMusicInput.value = idea.suara_musik || '';
                spokenLinesInput.value = idea.kalimat_diucapkan || '';
                additionalDetailsTextarea.value = idea.detail_tambahan || '';

                showToast("âœ¨ Prompt berhasil dikembangkan & formulir diperbarui!");
            } catch (error) {
                showToast(`Gagal mengembangkan prompt: ${error.message}`, true);
            } finally {
                setButtonLoading(geminiImproveBtn, false);
            }
        });

        async function translateText(text) {
            if (!text || !text.trim()) {
                return ""; 
            }
            const langPair = 'id|en';
            const apiUrl = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${langPair}`;

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                if (data.responseStatus !== 200) {
                     throw new Error(data.responseDetails || `Translation API error`);
                }
                return data.responseData.translatedText;
            } catch (error) {
                console.error('Translation error:', error);
                showToast(`Gagal menerjemahkan: "${text.substring(0,20)}...".`, true);
                return text;
            }
        }

        generateBtn.addEventListener('click', async () => {
            const subject = subjectInput.value.trim();
            const action = actionInput.value.trim();
            const place = placeInput.value.trim();
            let spokenLines = spokenLinesInput.value.trim();
            let additionalDetails = additionalDetailsTextarea.value.trim();

            if (!subject || !action || !place) {
                showToast("Mohon isi kolom Subjek, Aksi, dan Tempat.", true);
                return;
            }
            
            if (spokenLines) {
                const requiredPhrase = "Tidak ada Subtitel dari kalimat yang diucapkan";
                if (!additionalDetails.includes(requiredPhrase)) {
                    additionalDetails = additionalDetails ? `${requiredPhrase}. ${additionalDetails}` : requiredPhrase;
                    additionalDetailsTextarea.value = additionalDetails;
                }
            }

            setButtonLoading(generateBtn, true);

            try {
                const nationality = nationalitySelect.value;
                const time = timeSelect.value;
                const cameraMovement = cameraMovementSelect.value;
                const lighting = lightingSelect.value;
                const videoStyle = videoStyleSelect.value;
                const videoMood = videoMoodSelect.value;
                const genreFilm = genreFilmSelect.value;

                let promptId = `Sebuah video dengan gaya ${videoStyle}`;
                if (genreFilm !== 'Tidak Spesifik') {
                    promptId += ` dan genre ${genreFilm}`;
                }
                 promptId += `, menampilkan ${subjectInput.value.trim()}`;
                if (subjectClothingInput.value.trim()) promptId += ` mengenakan ${subjectClothingInput.value.trim()}`;
                if (nationality && nationality !== "Tidak Spesifik") promptId += ` berkebangsaan ${nationality}`;
                if (expressionInput.value.trim()) promptId += ` dengan ekspresi ${expressionInput.value.trim()}`;
                promptId += ` sedang ${action} di ${place} pada ${time}.`;
                
                let detailsIdArray = [`Gerakan Kamera: ${cameraMovement}`, `Pencahayaan: ${lighting}`, `Suasana Video: ${videoMood}`];
                if (soundMusicInput.value.trim()) detailsIdArray.push(`Suara/Musik: ${soundMusicInput.value.trim()}`);
                if (languageSelect.value !== 'Tidak Spesifik' && spokenLinesInput.value.trim()) {
                    detailsIdArray.push(`Kalimat yang Diucapkan (Bahasa ${languageSelect.value}): "${spokenLinesInput.value.trim()}"`);
                } else if (spokenLinesInput.value.trim()) {
                     detailsIdArray.push(`Kalimat yang Diucapkan: "${spokenLinesInput.value.trim()}"`);
                }

                if (additionalDetailsTextarea.value.trim()) detailsIdArray.push(`Detail Tambahan: ${additionalDetailsTextarea.value.trim()}`);
                promptId += `\n\n${detailsIdArray.join(".\n")}.`;
                promptOutputIdEditable.value = promptId.trim();

                const [
                    subjectEn, subjectClothingEn, actionEn, expressionEn, placeEn, soundMusicEn, additionalDetailsEn
                ] = await Promise.all([
                    translateText(subject),
                    translateText(subjectClothingInput.value.trim()),
                    translateText(action),
                    translateText(expressionInput.value.trim()),
                    translateText(place),
                    translateText(soundMusicInput.value.trim()),
                    translateText(additionalDetailsTextarea.value.trim())
                ]);

                let englishMainSentence = `A ${getSelectedEnText(videoStyleSelect)}`;
                if (genreFilm !== 'Tidak Spesifik') {
                    englishMainSentence += `, ${genreFilm} genre`;
                }
                englishMainSentence += ` video, featuring ${subjectEn}`;
                if (subjectClothingEn) englishMainSentence += ` wearing ${subjectClothingEn}`;
                if (nationalitySelect.value !== "Tidak Spesifik") englishMainSentence += ` of ${getSelectedEnText(nationalitySelect)} nationality`;
                if (expressionEn) englishMainSentence += ` with ${expressionEn} expression`;
                englishMainSentence += `, ${actionEn} at ${placeEn} during the ${getSelectedEnText(timeSelect)}.`;

                let detailsEnArray = [
                    `Camera Movement: ${getSelectedEnText(cameraMovementSelect)}.`,
                    `Lighting: ${getSelectedEnText(lightingSelect)}.`,
                    `Video Mood: ${getSelectedEnText(videoMoodSelect)}.`
                ];
                if (soundMusicEn) detailsEnArray.push(`Sound/Music: ${soundMusicEn}.`);
                if (spokenLinesInput.value.trim()) {
                    let spokenLineEn = `Spoken Lines: "${spokenLinesInput.value.trim()}".`;
                    if (languageSelect.value !== 'Tidak Spesifik') {
                       spokenLineEn = `Spoken Lines (in ${getSelectedEnText(languageSelect)}): "${spokenLinesInput.value.trim()}".`
                    }
                    detailsEnArray.push(spokenLineEn);
                }
                if (additionalDetailsEn) detailsEnArray.push(`Additional Details: ${additionalDetailsEn}.`);
                
                promptOutputEnFinal.textContent = `${englishMainSentence}\n\n${detailsEnArray.join("\n")}`.trim();

                generatedPromptOutputsContainer.style.display = 'block';
            } catch (error) {
                console.error("Error during generation process:", error);
                showToast("Terjadi kesalahan saat proses generasi prompt.", true);
            } finally {
                setButtonLoading(generateBtn, false);
            }
        });

        copyIdBtn.addEventListener('click', () => copyToClipboard(promptOutputIdEditable.value, "Prompt Bahasa Indonesia berhasil disalin!"));
        copyEnBtn.addEventListener('click', () => copyToClipboard(promptOutputEnFinal.textContent, "Prompt Bahasa Inggris berhasil disalin!"));

        function copyToClipboard(text, successMessage) {
            if (!text) return;
            navigator.clipboard.writeText(text).then(() => {
                showToast(successMessage);
            }).catch(err => {
                console.error('Fallback copy method used.');
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                textArea.style.opacity = "0"; 
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    showToast(successMessage);
                } catch (err) {
                    showToast("Gagal menyalin prompt.", true);
                }
                document.body.removeChild(textArea);
            });
        }

        function showToast(message, isError = false) {
            toastNotification.textContent = message;
            toastNotification.style.backgroundColor = isError ? '#ef4444' : '#1f2937'; 
            toastNotification.classList.add('show');
            setTimeout(() => {
                toastNotification.classList.remove('show');
            }, 3000); 
        }
    </script>
</body>
</html>
